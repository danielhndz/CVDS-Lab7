<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.cvds.sampleprj.dao.mybatis.mappers.ClienteMapper">
    <select id="consultarClientes" resultMap="ClienteResultMap">
        SELECT
        c.nombre,
        c.documento,
        c.telefono,
        c.direccion,
        c.email,
        c.vetado,
        ir.id,
        ir.fechainiciorenta,
        ir.fechafinrenta,
        i.id,
        i.nombre,
        i.descripcion,
        i.fechalanzamiento,
        i.tarifaxdia,
        i.formatorenta,
        i.genero,
        ti.id,
        ti.descripcion
        FROM VI_CLIENTES AS c
        LEFT JOIN VI_ITEMRENTADO AS ir ON c.documento = ir.CLIENTES_documento
        LEFT JOIN VI_ITEMS AS i ON ir.ITEMS_id = i.id
        LEFT JOIN VI_TIPOITEM AS ti ON i.TIPOITEM_id = ti.id;
    </select>

    <select id="consultarCliente" resultMap="ClienteResultMap" parameterType="long">
        SELECT
        c.nombre,
        c.documento,
        c.telefono,
        c.direccion,
        c.email,
        c.vetado,
        ir.id,
        ir.fechainiciorenta,
        ir.fechafinrenta,
        i.id,
        i.nombre,
        i.descripcion,
        i.fechalanzamiento,
        i.tarifaxdia,
        i.formatorenta,
        i.genero,
        ti.id,
        ti.descripcion
        FROM VI_CLIENTES AS c
        LEFT JOIN VI_ITEMRENTADO AS ir ON c.documento = ir.CLIENTES_documento
        LEFT JOIN VI_ITEMS AS i ON ir.ITEMS_id = i.id
        LEFT JOIN VI_TIPOITEM AS ti ON i.TIPOITEM_id = ti.id
        WHERE c.documento = #{docu};
    </select>
    
    <insert id="agregarItemRentadoACliente">
        INSERT INTO VI_ITEMRENTADO (CLIENTES_documento, ITEMS_id, fechainiciorenta, fechafinrenta)
        VALUES (#{idCli}, #{idItm}, #{fechaInicio}, #{fechaFin});
    </insert>

    <insert id="agregarItemRentadoAClienteConId">
        INSERT INTO VI_ITEMRENTADO (id, CLIENTES_documento, ITEMS_id, fechainiciorenta, fechafinrenta)
        VALUES (#{id}, #{idCli}, #{idItm}, #{fechaInicio}, #{fechaFin});
    </insert>

    <select id="consultarItemsCliente" parameterType="long" resultMap="edu.eci.cvds.sampleprj.dao.mybatis.mappers.ItemRentadoMapper.ItemRentadoResultMap">
        SELECT
            vc.nombre,
            vc.documento,
            vc.vetado,
            vi.id,
            vi.ITEMS_id,
            vi.fechainiciorenta,
            vi.fechafinrenta
            FROM
                VI_CLIENTES AS vc
            LEFT JOIN
                VI_ITEMRENTADO AS vi ON vc.documento = vi.CLIENTES_documento
            WHERE
                vc.documento = #{docu};
    </select>

    <insert id="registrarCliente" parameterType="Cliente">
        INSERT INTO VI_CLIENTES (documento, nombre, telefono, direccion, email, vetado)
        VALUES (#{cliente.documento}, #{cliente.nombre}, #{cliente.telefono}, #{cliente.direccion}, #{cliente.email}, #{cliente.vetado});
    </insert>

    <update id="vetarCliente">
        UPDATE VI_CLIENTES SET vetado = #{estado} WHERE documento = #{docu};
    </update>

    <delete id="limpiarClientes">
        DELETE FROM VI_CLIENTES;
    </delete>

    <resultMap id="ClienteResultMap" type="Cliente">
        <id column="documento" property="documento"/>
        <result column="nombre" property="nombre"/>
        <result column="telefono" property="telefono"/>
        <result column="direccion" property="direccion"/>
        <result column="email" property="email"/>
        <result column="vetado" property="vetado"/>
        <collection property="rentados" ofType="ItemRentado" resultMap="edu.eci.cvds.sampleprj.dao.mybatis.mappers.ItemRentadoMapper.ItemRentadoResultMap"/>
    </resultMap>
</mapper>